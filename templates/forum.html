{% extends "layout.html" %}
{% block title %}Forum{% endblock %}
{% block content %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="../static/src/favicon/favicon.ico">
    <link rel="stylesheet" href="../static/style.css">    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <title>APNet</title>

    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #F7F7F7;
        }

        /* FOOTER */
        .header-footer-main-container {
            display: none;
            position: fixed;
            justify-content: space-between;
            align-items: center;
            bottom: 0;
            width: 100%;
            height: 90px;
            padding: 0;
            box-sizing: border-box;
            border: 0px solid;
            background-color:	#212121;
            z-index: 1000;
        }

        .header-footer-container1, 
            .header-footer-container2, 
            .header-footer-container3,
            .header-footer-container4 {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100%;
                flex-grow: 1;   
                width: 25%;
            }

            .header-footer-container1 active {
                border-top: 5px solid #2A83FF;
            }

            .header-footer-forumwhiteicon, 
            .header-footer-recruitwhiteicon, 
            .header-footer-notifwhiteicon, 
            .header-footer-pfpicon {
                height: 40px;
                width: 40px;
                margin: 0 30px 10px 30px;
            }

            .header-footer-container1 h2, 
            .header-footer-container2 h2, 
            .header-footer-container3 h2, 
            .header-footer-container4 h2 {
                font-family: "Roboto", sans-serif;
                font-weight: bold;
                font-size: 10px;
                color: white; 
                text-decoration: none; 
            }


        
        @media (max-width: 430px) {
            
            /* HEADER */
            .header-main-container {
                height: 85px;
                padding: 0;
                box-sizing: content-box;
                position: fixed;
                top: 0;
            }

            .header-searchbar {
                display: none;
            }

            #header-logo {
                height: 60px;
                margin-left: 0px;
            }

            .header-searchicon {
                display: flex;
                height: 45px;
                width: 45px;
                padding: 5px;
                margin-right: 10px;
            }

            #header-profile-img {
                display: none;
                width: 55px;
                height: 55px;
                padding: 5px;
                margin-right: 20px;
            }

            .header-infoicon {
                display: flex;
                height: 45px;
                width: 45px;
                padding: 5px;
                margin-right: 15px;
            }


            /* FOOTER */
            .header-footer-main-container {
                display: flex;
            }

            /* NAV BAR */
            .nb-left-container {
                display: none;
            }
        }
        
    </style>
</head>
<body>
    <!-- HEADER CONTENT -->
    <header>
        <div class="ha-main-container">

            <div class="ha-logo-container">
                <a href="/"><img src="../static/src/img/apnet-logo.png" id="ha-logo-img"></a>
            </div>

            <div class="ha-search-container">
                <input type="text" id="ha-searchbar" placeholder="Search APNet...">
            </div>
            
            <div class="ha-right-container">

                <div class="ha-createpost-container">
                    <a href="forumspecific.html">                        
                        <img src="../static/src/icon/icons8-plus-48.png" alt="Plus" id="ha-plusicon">
                        <h2>Create Post</h2>
                    </a>
                </div>

                <img src="../static/src/icon/icons8-notification-50.png" alt="Notification Icon" id="ha-notificon">

                <img src="../static/src/img/default-pfp.png" alt="Pfp" id="ha-pfpimg">
                

            </div>

        </div>
    </header>
    

    <!-- NAV BAR -->
    <div class="nb-left-container">

        <h1 style="margin-top: 20px;">MAIN PAGES</h1>
    
        <div class="nb-mainpages-container">    

            <a href="/"><div class="nb-mainpages-home">
                 <img src="../static/src/icon/icons8-forum-50.png" alt="Forum Default Icon" id="nb-forumicon">
                 <h2>Forum</h2>
            </div></a> 

            <a href="#"><div class="nb-mainpages-recruitment">
                <img src="../static/src/icon/icons8-resume-50.png" alt="Resume Default Icon" id="nb-resumeicon">
                <h2>Recruitment</h2>
            </div></a> 
        </div>

        <hr>

        <h1>OTHER PAGES</h1>

        <div class="nb-otherpages-container">

            <a href="#">
                <div class="nb-otherpages-applicationlisting">
                    <img src="../static/src/icon/icons8-list-48.png" alt="List Default Icon" id="nb-listicon">
                    <h2>View Application Listings</h2>
                </div>
            </a>

            <a href="#">
                <div class="nb-otherpages-applicantlisting">
                    <img src="../static/src/icon/icons8-person-64.png" alt="Person Default Icon" id="nb-personicon">
                    <h2>View Applicants</h2>
                </div>
            </a>

            <a href="#">
                <div class="nb-otherpages-likedposts">
                    <img src="../static/src/icon/icons8-heart-50.png" alt="Heart Default Icon" id="nb-hearticon">
                    <h2>Liked Posts</h2>
                </div>
            </a>

            <a href="#">
                <div class="nb-otherpages-bookmark">
                    <img src="../static/src/icon/icons8-bookmark-32.png" alt="Bookmark Default Icon" id="nb-bookmarkicon">
                    <h2>Bookmarked Posts</h2>
                </div>
            </a>

        </div>

        <hr>

        <h1>RESOURCES</h1>

        <div class="nb-resources-container">
            
            <a href="aboutus.html"><div class="nb-resources-aboutus">
                <img src="../static/src/icon/icons8-info-50.png" alt="Info Default Icon" id="nb-infoicon">
                <h2>About Us</h2>
            </div></a>
          

            <a href="#"><div class="nb-resources-faqs">
                <img src="../static/src/icon/icons8-faq-50.png" alt="FAQ Default Icon" id="nb-faqicon">
                <h2>FAQs</h2>
            </div></a>

            <a href="#"><div class="nb-resources-tnc">
                <img src="../static/src/icon/icons8-scales-50.png" alt="Scales Default Icon" id="nb-scalesicon">
                <h2>Terms and Conditions</h2>
            </div></a>

        </div>

    </div>

    <!-- BODY CONTENT -->
    <div class="fm-main-container" id="postContainer">
        <div id="loading" style="display:none;">Loading...</div>
        <div id="no-more-posts" style="display:none; text-align: center; font-size: 20px;">No more posts to load</div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.body.addEventListener('click', function(event) {
                const clickedDropdown = event.target.closest('.dropdown');
                
                if (clickedDropdown) {
                    const dropdownContent = clickedDropdown.querySelector('.dropdown-content');
                    
                    document.querySelectorAll('.dropdown-content').forEach(function(dropdown) {
                        if (dropdown !== dropdownContent) {
                            dropdown.style.display = 'none';
                        }
                    });
    
                    dropdownContent.style.display = dropdownContent.style.display === "block" ? "none" : "block";
                    event.stopPropagation();
                } else {
                    document.querySelectorAll('.dropdown-content').forEach(function(dropdown) {
                        dropdown.style.display = 'none';
                    });
                }
            });
    
            window.addEventListener('scroll', function() {
                document.querySelectorAll('.dropdown-content').forEach(function(dropdown) {
                    dropdown.style.display = 'none';
                });
            });
        });
    
        let currentPage = 1;
        let loadedPostIds = new Set();
        const postContainer = document.getElementById('postContainer');
        const loadingIndicator = document.getElementById('loading');
        let isLoading = false;
    
        function loadPosts() {
            if (isLoading) return;
    
            isLoading = true;
            loadingIndicator.style.display = 'block';
    
            const postIds = Array.from(postContainer.querySelectorAll('.fm-post-layout'))
                .map(post => post.getAttribute('data-post-id'))
                .filter(postId => postId && postId.trim() !== "");
    
            postIds.forEach(postId => loadedPostIds.add(postId));
    
            fetch('/load_more?page=' + currentPage + '&loaded_post_ids=' + JSON.stringify(Array.from(loadedPostIds)))
                .then(response => response.json())
                .then(data => {
                    if (data.post_html) {
                        postContainer.insertAdjacentHTML('beforeend', data.post_html);
                        currentPage++;
                    }
    
                    let noMorePostsMessage = document.getElementById('no-more-posts');
                    if (noMorePostsMessage) {
                        noMorePostsMessage.remove();
                    }
    
                    if (data.no_more_posts) {
                        noMorePostsMessage = document.createElement('div');
                        noMorePostsMessage.id = 'no-more-posts';
                        // honestly this can be css but i found this on a forum and i am too lazy to change it
                        noMorePostsMessage.style.textAlign = 'center';
                        noMorePostsMessage.style.fontSize = '20px';
                        noMorePostsMessage.textContent = 'No more posts to load';
    
                        postContainer.appendChild(noMorePostsMessage);
                    }
    
                    loadingIndicator.style.display = 'none';
                    isLoading = false;
                })
                .catch(error => {
                    console.error('Error loading posts:', error);
                    loadingIndicator.style.display = 'none';
                    isLoading = false;
                });
            }
    
        window.addEventListener('scroll', () => {
            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 10 && !isLoading) {
                loadPosts();
            }
        });
    
        document.addEventListener('DOMContentLoaded', () => {
            loadPosts();
        });
    </script>


    <!-- FOOTER CONTENT -->
    <footer>
        
        <div class="header-footer-main-container">
            
            <div class="header-footer-container1">
                <img src="../static/src/icon/icons8-forum-blue-50.png" alt="Forum Icon" class="header-footer-forumblueicon">
                <h2>Forum</h2>
            </div>
    
            <div class="header-footer-container2">
                <img src="../static/src/icon/icons8-resume-white-50.png" alt="Recruit Icon" class="header-footer-recruitwhiteicon">
                <h2>Recruitment</h2>
            </div>
    
            <div class="header-footer-container3">
                <img src="../static/src/icon/icons8-notification-white-48.png" alt="Notification Icon" class="header-footer-notifwhiteicon">
                <h2>Notifications</h2>
            </div>
    
            <div class="header-footer-container4">
                <a href="profile.html"><img src="../static/src/img/default-pfp.png" alt="Profile Pic Icon" class="header-footer-pfpicon"></a>
                <h2>Profile</h2>
            </div>
    
        </div>
    
    </footer>
</body>
{% endblock content %}