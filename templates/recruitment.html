{% extends "header-a.html" %}
{% block title %}Recruitment{% endblock title %}
{% block content %}
<body>
    <!-- NAV BAR -->
    <div class="nb-left-container">

        <h1 style="margin-top: 20px;">MAIN PAGES</h1>
    
        <div class="nb-mainpages-container">    

            <a href="http://127.0.0.1:5000/#"><div class="nb-mainpages-home">
                 <img src="../static/src/icon/icons8-forum-darkblue-50.png" alt="Forum Default Icon" id="nb-forumicon">
                 <h2>Forum</h2>
            </div></a> 

            <a href="recruitment"><div class="nb-mainpages-recruitment" style="background-color: #d0e8ff;">
                <img src="../static/src/icon/icons8-resume-48.png" alt="Resume Default Icon" id="nb-resumeicon">
                <h2>Recruitment</h2>
            </div></a> 
        </div>

        <hr>

        <h1>OTHER PAGES</h1>

        <div class="nb-otherpages-container">

            <a href="#">
                <div class="nb-otherpages-applicationlisting">
                    <img src="../static/src/icon/icons8-list-48.png" alt="List Default Icon" id="nb-listicon">
                    <h2>View Application Listings</h2>
                </div>
            </a>

            <a href="#">
                <div class="nb-otherpages-applicantlisting">
                    <img src="../static/src/icon/icons8-name-tag-yellow-96.png" alt="Person Default Icon" id="nb-personicon">
                    <h2>View Applicants</h2>
                </div>
            </a>

            <a href="#">
                <div class="nb-otherpages-likedposts">
                    <img src="../static/src/icon/icons8-heart-red-50.png" alt="Heart Default Icon" id="nb-hearticon">
                    <h2>Liked Posts</h2>
                </div>
            </a>

            <a href="#">
                <div class="nb-otherpages-bookmark">
                    <img src="../static/src/icon/icons8-bookmark-evendarkergreen-500.png" alt="Bookmark Default Icon" id="nb-bookmarkicon">
                    <h2>Bookmarked Posts</h2>
                </div>
            </a>

        </div>

        <hr>

        <h1>RESOURCES</h1>

        <div class="nb-resources-container">
            
            <a href="aboutus"><div class="nb-resources-aboutus">
                <img src="../static/src/icon/icons8-info-coolcolour-50.png" alt="Info Default Icon" id="nb-infoicon">
                <h2>About Us</h2>
            </div></a>
          

            <a href="#"><div class="nb-resources-faqs">
                <img src="../static/src/icon/icons8-faq-gray-50.png" alt="FAQ Default Icon" id="nb-faqicon">
                <h2>FAQs</h2>
            </div></a>

            <a href="#"><div class="nb-resources-tnc">
                <img src="../static/src/icon/icons8-scales-48.png" alt="Scales Default Icon" id="nb-scalesicon">
                <h2>Terms and Conditions</h2>
            </div></a>

        </div>

    </div>

    <!-- BODY CONTENT -->
    <div class="rc-main-container">
        
        <!-- POST LAYOUT -->
        <div class="rc-post-layout">

            <div class="rc-title-container">
                <h1>INSERT RECRUITMENT TITLE</h3>
            </div>

            
            <div class="rc-profiledetails">
                <!-- INSERT PFP HERE -->
                <img src="../static/src/img/default-pfp.png" alt="Default pfp icon" id="rc-post-pfp">
                <!-- INSERT USERNAME HERE -->
                <h1>INSERT CLUBNAME</h1>
                <!-- INSERT LAST CREATION DATE THING -->
                <h2> • </h2>
                <h2>Posted x days ago</h2>

                <div class="rc-more-container">
                    <div class="rc-dropdown">
                        <span><img src="../static/src/icon/icons8-ellipsis-48.png" alt="Elipses" id="rc-moreicon" height="24" width="24"></span>
                        <div class="rc-dropdown-content">
                            <a href="#" class="rc-dropdown-item">
                                <img src="../static/src/icon/icons8-flag-48.png" alt="Report Post" id="rc-reportposticon" height="20" width="20"> Report Post
                            </a>
                            <a href="#" class="rc-dropdown-item">
                                <img src="../static/src/icon/icons8-danger-50.png" alt="Report User" id="rc-reportusericon" height="20" width="20"> Report User
                            </a>
                            <a href="#" class="rc-dropdown-item">
                                <img src="../static/src/icon/icons8-edit-96.png" alt="Edit" id="rc-editicon" height="20" width="20">Edit Post
                            </a>
                            <a href="#" class="rc-dropdown-item">
                                <img src="../static/src/icon/icons8-delete-48.png" alt="Delete" id="rc-deleteicon" height="20" width="20">Delete Post
                            </a>
                        </div>
                    </div>
                </div>               

            </div>

            <div class="rc-image-container">
                <!-- INSERT IMAGE HERE -->
                <img src="../static/src/img/basketball-club.png" alt="">
            </div>
            
            <div class="rc-button-container">
      
                <!-- LIKE BUTTON -->
                <div class="rc-like-icon-container">
                    <img src="../static/src/icon/icons8-heart-50.png" alt="Heart" id="rc-post-hearticon">
                    <h2>Like</h2>
                    <!-- LIKE AMOUNT -->
                    <h4>(12)</h4>
                </div>
                

                <!-- COMMENT BUTTON -->
                <div class="rc-comment-icon-container">
                    <img src="../static/src/icon/icons8-comment-50.png" alt="Comment" id="rc-post-commenticon">
                    <h2>Comment</h2>
                    <!-- COMMENT AMOUNT -->
                    <h4>(0)</h4>
                </div>


                <!-- BOOKMARK BUTTON -->
                 <div class="rc-bookmark-icon-container">
                     <img src="../static/src/icon/icons8-bookmark-50.png" alt="Bookmark" id="rc-post-bookmarkicon">
                 </div>

            </div>


            <!-- INSERT COMMENT -->
            <div class="rc-caption-container">
                <h1>CLUB DESCRIPTION</h1>
                <!-- <h2>The old clock tower stood tall, its rusted gears ticking in defiance of time. A stray cat perched on the windowsill, watching the bustling streets below. Lanterns flickered, casting long shadows as the wind whispered secrets through the alleyways. Somewhere, a violin played a haunting melody</h2> -->
                <h2>The rain drummed against the cobblestone streets as neon signs flickered in the misty night. A stranger in a tattered coat hurried past, clutching a leather-bound book with golden edges. In the distance, a train whistled, its echo swallowed by the howling wind. A small café glowed warmly, steam curling from porcelain cups as an old radio played a forgotten tune. The scent of freshly baked bread mixed with the distant sea breeze. Somewhere, a dog barked, chasing its own shadow in the dim light.</h2>
            </div>

            <div class="rc-post-footer">
                <span class="rc-interest-text">Interested? Join Us Now!</span>
                <!-- MAKE IT LEAD TO THE RECRUITMENT APPLICATION -->
                <a href="recruitment_application.html"><button class="rc-apply-button">Apply</button></a>
            </div>

        </div>

      

    
    </div>




    <!-- FOOTER CONTENT -->
    <footer>
        
        <div class="header-footer-main-container">
            
            <div class="header-footer-container1">
                <img src="../static/src/icon/icons8-forum-blue-50.png" alt="Forum Icon" class="header-footer-forumblueicon">
                <h2>Forum</h2>
            </div>
    
            <div class="header-footer-container2">
                <img src="../static/src/icon/icons8-resume-white-50.png" alt="Recruit Icon" class="header-footer-recruitwhiteicon">
                <h2>Recruitment</h2>
            </div>
    
            <div class="header-footer-container3">
                <img src="../static/src/icon/icons8-notification-white-48.png" alt="Notification Icon" class="header-footer-notifwhiteicon">
                <h2>Notifications</h2>
            </div>
    
            <div class="header-footer-container4">
                <a href="profile.html"><img src="../static/src/img/default-pfp.png" alt="Profile Pic Icon" class="header-footer-pfpicon"></a>
                <h2>Profile</h2>
            </div>
    
        </div>
    
    </footer>

    <script>
        
        let currentPage = 1;
        let loadedPostIds = new Set();
        const postContainer = document.getElementById('postContainer');
        let isLoading = false;

        // Loading Post
        function loadPosts(searchTerm = '', type = 'post') {
            if (isLoading) return;

            isLoading = true;

            const postIds = Array.from(postContainer.querySelectorAll('.rc-post-layout'))
                .map(post => post.getAttribute('data-post-id'))
                .filter(postId => postId && postId.trim() !== "");

            postIds.forEach(postId => loadedPostIds.add(postId));

            const url = '/load_more?page=' + currentPage + 
                        '&loaded_ids=' + JSON.stringify(Array.from(loadedPostIds)) + 
                        '&type=' + encodeURIComponent(type) +
                        (searchTerm ? '&search=' + encodeURIComponent(searchTerm) : '');

            //Will Change This To Post When I Can
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.html) {
                        postContainer.insertAdjacentHTML('beforeend', data.html);
                        currentPage++;
                        filter3DotMenu(data.user_id);
                    }

                    let noMorePostsMessage = document.getElementById('no-more-posts');
                    if (noMorePostsMessage) {
                        noMorePostsMessage.remove();
                    }

                    if (data.no_more_posts) {
                        noMorePostsMessage = document.createElement('div');
                        noMorePostsMessage.id = 'no-more-posts';
                        noMorePostsMessage.style.textAlign = 'center';
                        noMorePostsMessage.style.fontSize = '20px';
                        noMorePostsMessage.textContent = 'No more posts to load';

                        postContainer.appendChild(noMorePostsMessage);
                    }

                    isLoading = false;
                })
                .catch(error => {
                    console.error('Error loading posts:', error);
                    isLoading = false;
                });
        }

        function updateLikeUI(container, liked, count) {
            const likeCountElement = container.querySelector("h4");
            const likeIcon = container.querySelector("img");

            likeIcon.src = liked
                ? "../static/src/icon/icons8-heart-red-50.png"
                : "../static/src/icon/icons8-heart-50.png";

            if (likeCountElement) {
                likeCountElement.textContent = `(${count})`;
            }
        }

        function updateBookmarkUI(container, bookmark) {
            const bookmarkIcon = container.querySelector("img");

            if (!bookmarkIcon) return;

            bookmarkIcon.src = bookmark
                ? "../static/src/icon/icons8-bookmark-evendarkergreen-500.png"
                : "../static/src/icon/icons8-bookmark-50.png";
        }
        

        // 3 Dot Menu Filter
        function filter3DotMenu(loggedInUserId) {
            document.querySelectorAll(".rc-post-layout").forEach(post => {
                const postUserId = post.getAttribute("data-user-id");
                const dropdown = post.querySelector(".rc-dropdown-content");

                if (dropdown) {
                    const reportPost = dropdown.querySelector("#fm-reportposticon")?.parentElement;
                    const reportUser = dropdown.querySelector("#fm-reportusericon")?.parentElement;
                    const editPost = dropdown.querySelector("#fm-editicon")?.parentElement;
                    const deletePost = dropdown.querySelector("#fm-deleteicon")?.parentElement;

                    if (reportPost && reportUser && editPost && deletePost) {
                        if (String(loggedInUserId) === String(postUserId)) {
                            reportPost.style.display = "none";
                            reportUser.style.display = "none";
                            editPost.style.display = "block";
                            deletePost.style.display = "block";
                        } else {
                            reportPost.style.display = "block";
                            reportUser.style.display = "block";
                            editPost.style.display = "none";
                            deletePost.style.display = "none";
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.body.addEventListener('click', function(event) {
                // 3 Dot Menu
                const clickedDropdown = event.target.closest('.rc-dropdown');
                
                if (clickedDropdown) {
                    const dropdownContent = clickedDropdown.querySelector('.rc-dropdown-content');
                    
                    document.querySelectorAll('.rc-dropdown-content').forEach(function(dropdown) {
                        if (dropdown !== dropdownContent) { 
                            dropdown.style.display = 'none';
                        }
                    });

                    if (dropdownContent.style.display === "block") {
                        dropdownContent.style.display = "none"; 
                    } else {
                        dropdownContent.style.display = "block";
                    }

                    event.stopPropagation();
                } else {
                    document.querySelectorAll('.rc-dropdown-content').forEach(function(dropdown) {
                        dropdown.style.display = 'none';
                    });
                }
            });

            document.body.addEventListener("click", function (event) {
                let actionContainer = event.target.closest("[data-action]");

                if (!actionContainer && event.target.tagName === "IMG") {
                    actionContainer = event.target.parentElement.closest("[data-action]");
                }

                if (!actionContainer) return;

                const postElement = actionContainer.closest(".rc-post-layout");
                if (!postElement) return;

                const postId = postElement.getAttribute("data-post-id");
                const action = actionContainer.getAttribute("data-action");

                if (!postId || !action) return;

                console.log(action); //Remove Later
                console.log(postId);
                console.log(actionContainer);
                if (action === "liked" || action === "bookmark") {
                    fetch("/engagement", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ post_id: postId, action: action }),
                    })
                    .then((response) => response.json())
                    .then((data) => {
                        if (data.error) {
                            alert(data.error);
                            return;
                        }

                        if (action === "liked") {
                            updateLikeUI(actionContainer, data.liked, data.likes_count);
                        } else if (action === "bookmark") {
                            updateBookmarkUI(actionContainer, data.bookmark);
                        }
                    })
                    .catch((error) => console.error("Error:", error));
                } else if (action === "specific") {
                    window.location.href = "/specificpost?postid=" + encodeURIComponent(postId);
                }
            });





            document.body.addEventListener("click", function (event) { 
                let actionContainer = event.target.closest("[data-action]");
                if (!actionContainer && event.target.tagName === "IMG") {
                    actionContainer = event.target.parentElement.closest("[data-action]");
                }
            });


            // 3 Dot Menu Scroll
            window.addEventListener('scroll', function() {
                if (isLoading) return;
                
                if (window.innerHeight + window.scrollY < document.body.offsetHeight - 10) {
                    document.querySelectorAll('.rc-dropdown-content').forEach(function(dropdown) {
                        dropdown.style.display = 'none';
                    });
                }
            });

            // Searchbar
            const searchContainer = document.getElementById('ha-searchbar');
            searchContainer.addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                    event.preventDefault(); 

                    const searchTerm = searchContainer.value.trim();

                    if (searchTerm) {
                        window.location.href = "/?search=" + encodeURIComponent(searchTerm);
                    }
                }
            });
        
            const urlParams = new URLSearchParams(window.location.search);
            const searchTerm = urlParams.get('search') || '';
            loadPosts(searchTerm);
        });

        // Scrolling
        window.addEventListener('scroll', () => {
            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 10 && !isLoading) {
                const urlParams = new URLSearchParams(window.location.search);
                const searchTerm = urlParams.get('search') || ''; 
                loadPosts(searchTerm);
            }
        });    
    </script>

</body>
{% endblock content %}